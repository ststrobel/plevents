<h2>Anmeldung zu Aktivität</h2>
<div *ngIf="!successfullyRegistered && classOptions != null">
  <form (change)="selectClass($event.target.value)">
    <div class="form-group">
      <label for="classSelect">In welcher Klasse bist du?</label>
      <select class="form-control" id="classSelect">
        <option>--- bitte auswählen ---</option>
        <option *ngFor="let classOption of classOptions">
          {{ classOption }}
        </option>
      </select>
    </div>
  </form>
</div>
<div
  *ngIf="
    !successfullyRegistered &&
    selectedClass != null &&
    selectedClass != '--- bitte auswählen ---'
  "
>
  <p>
    Registriere dich bitte für <b>maximal eine</b> der folgenden Aktivitäten:
  </p>
  <!-- horizontal table -->
  <table class="w-100 d-none d-lg-table">
    <thead>
      <tr *ngIf="uniqueEvents">
        <th [ngStyle]="{ width: 100 / (uniqueEvents.length + 1) + '%' }">KW</th>
        <th
          [ngStyle]="{ width: 100 / (uniqueEvents.length + 1) + '%' }"
          style="text-align: center"
          *ngFor="let uniqueEvent of uniqueEvents"
        >
          {{ uniqueEvent.displayName() }}
          <br />
          <span class="badge badge-secondary">{{
            uniqueEvent.displayTime()
          }}</span>
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="weeks[0] != null">
        <td>{{ weeks[0].number }}<br />(diese Woche)</td>
        <td *ngFor="let event of weeks[0].events">
          <app-event-select
            [event]="event"
            (click)="selectEvent(event)"
            [selected]="event === selectedEvent"
          ></app-event-select>
        </td>
      </tr>
      <tr *ngIf="weeks[1] != null">
        <td>{{ weeks[1].number }}<br />(nächste Woche)</td>
        <td *ngFor="let event of weeks[1].events">
          <app-event-select
            [event]="event"
            (click)="selectEvent(event)"
            [selected]="event === selectedEvent"
          ></app-event-select>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- vertical table -->
  <table class="w-100 d-lg-none">
    <thead>
      <tr>
        <th style="width: 30%"></th>
        <th style="width: 35%" *ngIf="weeks[0] != null">
          {{ weeks[0].number }}<br />(diese Woche)
        </th>
        <th style="width: 35%" *ngIf="weeks[1] != null">
          {{ weeks[1].number }}<br />(nächste Woche)
        </th>
      </tr>
    </thead>
    <tbody *ngIf="uniqueEvents">
      <tr *ngFor="let uniqueEvent of uniqueEvents; index as i">
        <td>
          {{ uniqueEvent.displayName() }}
          <br />
          <span class="badge badge-secondary">{{
            uniqueEvent.displayTime()
          }}</span>
        </td>
        <td>
          <app-event-select
            *ngIf="weeks[0].events[i]"
            [event]="weeks[0].events[i]"
            (click)="selectEvent(weeks[0].events[i])"
            [selected]="weeks[0].events[i] === selectedEvent"
          ></app-event-select>
        </td>
        <td>
          <app-event-select
            *ngIf="weeks[1].events[i]"
            [event]="weeks[1].events[i]"
            (click)="selectEvent(weeks[1].events[i])"
            [selected]="weeks[1].events[i] === selectedEvent"
          ></app-event-select>
        </td>
      </tr>
    </tbody>
  </table>

  <div style="margin-top: 40px" *ngIf="selectedEvent">
    <div
      *ngIf="selectedEvent && selectedEvent.isInPast()"
      class="alert alert-secondary"
    >
      Dieses Event liegt in der Vergangenheit. Keine Aktion möglich.
    </div>

    <div
      *ngIf="
        selectedEvent &&
        !selectedEvent.isInPast() &&
        selectedEvent.takenSeats >= selectedEvent.maxSeats
      "
      class="alert alert-danger"
    >
      Dieses Event ist bereits leider ausgebucht!
    </div>
    <div
      *ngIf="
        selectedEvent &&
        !selectedEvent.isInPast() &&
        selectedEvent.takenSeats < selectedEvent.maxSeats
      "
    >
      <h5>Angaben zu Teilnehmer:</h5>
      <form [formGroup]="registerForm" (ngSubmit)="registerParticipant()">
        <div class="row">
          <div
            class="col-6 col-md-4"
            [ngClass]="{ invalid: isInvalid('name') }"
          >
            <label for="name">Teilnehmer</label>
            <br />
            <input
              class="form-control"
              id="name"
              type="text"
              placeholder="Name des Teilnehmers"
              formControlName="name"
            />
          </div>
          <div
            class="col-6 col-md-4"
            [ngClass]="{ invalid: isInvalid('email') }"
          >
            <label for="email">Email</label>
            <br />
            <input
              class="form-control"
              id="email"
              type="email"
              placeholder="Kontakt-Email Adresse"
              formControlName="email"
            />
          </div>
          <div
            class="col-6 col-md-4"
            [ngClass]="{ invalid: isInvalid('phone') }"
          >
            <label for="phone">Telefonnummer</label>
            <br />
            <input
              class="form-control"
              id="phone"
              type="phone"
              placeholder="Telefonnr für Rückfragen"
              formControlName="phone"
            />
          </div>
          <div
            class="col-6 col-md-4"
            [ngClass]="{ invalid: isInvalid('street') }"
          >
            <label for="street">Adresse</label>
            <br />
            <input
              class="form-control"
              id="street"
              type="text"
              placeholder="Straße & Hausnummer"
              formControlName="street"
            />
          </div>
          <div class="col-6 col-md-4" [ngClass]="{ invalid: isInvalid('zip') }">
            <label for="zip">PLZ</label>
            <br />
            <input
              class="form-control"
              id="zip"
              type="text"
              placeholder="Postleitzahl"
              formControlName="zip"
            />
          </div>
          <div
            class="col-6 col-md-4"
            [ngClass]="{ invalid: isInvalid('city') }"
          >
            <label for="city">Ort</label>
            <br />
            <input
              class="form-control"
              id="city"
              type="text"
              placeholder="Wohnort"
              formControlName="city"
            />
          </div>
          <div
            class="col-12 col-md-8 form-check"
            style="padding-top: 26px; padding-left: 1.25rem"
          >
            <div
              *ngIf="consentTeaser1 && consentTeaser1.length > 0"
              [ngClass]="{
                invalid:
                  registerForm.touched &&
                  registerForm.get('consent1').value === false
              }"
            >
              <input
                class="form-check-input"
                id="consent1"
                type="checkbox"
                formControlName="consent1"
                style="margin-left: 0px"
              />
              <label
                class="form-check-label"
                for="consent1"
                style="margin-bottom: 0; margin-left: 1.25rem; cursor: pointer"
                >{{ consentTeaser1 }}</label
              >
              &nbsp;
              <span *ngIf="consentText1 && consentText1.length > 0">
                <small
                  *ngIf="!consentText1Shown"
                  (click)="consentText1Shown = true"
                  class="consent-toggler"
                  >Details anzeigen</small
                >
                <small
                  *ngIf="consentText1Shown"
                  (click)="consentText1Shown = false"
                  class="consent-toggler"
                  >Details ausblenden</small
                >
              </span>
              <div *ngIf="consentText1Shown" [innerHTML]="consentText1"></div>
            </div>
            <div
              *ngIf="consentTeaser2 && consentTeaser2.length > 0"
              [ngClass]="{
                invalid:
                  registerForm.touched &&
                  registerForm.get('consent2').value === false
              }"
            >
              <input
                class="form-check-input"
                id="consent2"
                type="checkbox"
                formControlName="consent2"
                style="margin-left: 0px"
              />
              <label
                class="form-check-label"
                for="consent2"
                style="margin-bottom: 0; margin-left: 1.25rem; cursor: pointer"
                >{{ consentTeaser2 }}</label
              >
              &nbsp;
              <span *ngIf="consentText2 && consentText2.length > 0">
                <small
                  *ngIf="!consentText2Shown"
                  (click)="consentText2Shown = true"
                  class="consent-toggler"
                  >Details anzeigen</small
                >
                <small
                  *ngIf="consentText2Shown"
                  (click)="consentText2Shown = false"
                  class="consent-toggler"
                  >Details ausblenden</small
                >
              </span>
              <div *ngIf="consentText2Shown" [innerHTML]="consentText2"></div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <button
              class="btn btn-block btn-success"
              type="submit"
              style="margin-top: 32px"
            >
              Zum Event anmelden
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<div *ngIf="successfullyRegistered" class="alert alert-success successBox">
  Du hast dich erfolgreich zu <b>{{ selectedEvent.name }}</b> angemeldet!
  <br />
  <br />
  Bitte beachte, dass du dich nicht für weitere Events in dieser Woche anmelden
  kannst.
</div>
