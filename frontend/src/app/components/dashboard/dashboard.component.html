<h2>Übersicht über alle anstehenden Events</h2>

<div style="margin-top: 40px">
  <h5>Hier können Sie ein neues Reihenevent anlegen:</h5>
  <form [formGroup]="newEventForm" (ngSubmit)="addNewEvent()">
    <div class="row">
      <div class="col-6 col-md-4" [ngClass]="{ invalid: isInvalid('name') }">
        <label for="name">Event-Name</label>
        <br />
        <input
          class="form-control"
          id="name"
          type="text"
          formControlName="name"
        />
      </div>
      <div
        class="col-6 col-md-4"
        [ngClass]="{ invalid: isInvalid('fromDate') }"
      >
        <label for="fromDate">frühester Termin</label>
        <br />
        <input
          class="form-control"
          id="fromDate"
          type="date"
          formControlName="fromDate"
        />
      </div>
      <div class="col-12 col-md-4" [ngClass]="{ invalid: isInvalid('class') }">
        <label for="targetClass">für Klasse</label>
        <br />
        <input
          class="form-control"
          id="targetClass"
          type="text"
          formControlName="class"
        />
      </div>
      <div class="col-6 col-md-4" [ngClass]="{ invalid: isInvalid('time') }">
        <label for="name">Startzeit</label>
        <br />
        <input
          class="form-control"
          id="time"
          type="time"
          formControlName="time"
        />
      </div>
      <div
        class="col-6 col-md-4"
        [ngClass]="{ invalid: isInvalid('maxSeats') }"
      >
        <label for="maxSeats">max. Teilnehmer</label>
        <br />
        <input
          class="form-control"
          id="maxSeats"
          type="number"
          formControlName="maxSeats"
        />
      </div>
      <div class="col-12 col-md-4">
        <button
          class="btn btn-block btn-outline-success"
          type="submit"
          style="margin-top: 32px"
          [disabled]="operationOngoing"
        >
          Event erstellen
        </button>
      </div>
    </div>
  </form>
</div>

<table>
  <thead>
    <tr>
      <th style="width: 100px">KW</th>
      <th
        style="width: 300px; text-align: center"
        *ngFor="let uniqueEvent of uniqueEvents"
      >
        {{ uniqueEvent.displayName() }}
        <br />
        {{ uniqueEvent.displayTime() }}
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let week of weeks">
      <td [ngClass]="{ currentCW: week.number === currentCW() }">
        {{ week.number }}
        <small *ngIf="week.number === currentCW()"><br />aktuelle Woche</small>
      </td>
      <td
        *ngFor="let event of week.events"
        class="greyedOut"
        style="
          border: 1px solid white;
          height: 25px;
          line-height: 25px;
          text-align: center;
        "
        [ngClass]="{
          happening: event,
          unavailable: event && event.takenSeats >= event.maxSeats
        }"
      >
        <div
          *ngIf="event"
          [ngClass]="{ disabled: event.disabled }"
          style="position: relative"
        >
          {{ event.displayDate() }}<br />
          <small>{{ event.takenSeats }} / {{ event.maxSeats }} </small
          ><i
            class="fas fa-2x fa-file-pdf downloadIcon"
            (click)="downloadPdf(event)"
            title="Download Teilnehmerliste"
          ></i>
          <small class="stateToggler" (click)="toggleDisabled(event)">
            <i *ngIf="!event.disabled">aktiv</i>
            <i *ngIf="event.disabled">inaktiv</i>
          </small>
        </div>
      </td>
    </tr>
    <tr>
      <td></td>
      <td *ngFor="let uniqueEvent of uniqueEvents; let i = index">
        <button
          class="btn btn-sm btn-block btn-outline-danger my-2 my-sm-0"
          (click)="deleteEventSeries(i)"
          [disabled]="operationOngoing"
        >
          Löschen
        </button>
      </td>
    </tr>
  </tbody>
</table>
